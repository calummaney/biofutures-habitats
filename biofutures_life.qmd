---
title: "Implementing LIFE in Biofutures"
format: pdf
editor: visual
---

## Intro: LIFE under land-use scenarios from the NFF

The [LIFE metric](https://royalsocietypublishing.org/doi/10.1098/rstb.2023.0327) represents the impact of land cover change on species extinctions worldwide. It has been used so far to produce a "monitoring" style contemporary layer, and in broadly-defined scenarios of restoration and conservation.

We propose to apply these methods to "scenarios" – quantified visions of the future – based on global interpretations of the [Nature Futures Framework](https://www.pbl.nl/en/publications/report-on-the-workshop-next-steps-in-developing-nature-futures). This method, based in the LandSymm modelling framework, outlines three (plus one comparison scenario) scenarios of global land use where decisions relating to nature are made based on quintessential characterisations of how people value nature.

-   "Intrinsic", or "Nature for Nature" scenarios focus on a value perspective aiming to preserve the maximum diversity of life at the scale of decision-making, focusing on preserving eco-evolutionary novelty and reducing species extinctions.

-   "Instrumental" or "Nature for Society" scenarios focus on a value perspective related to the contributions nature makes to human society, through ecosystem services. Maintaining the functional health of ecosystems is of key importance here.

-   "Relational" or "Nature as Culture" scenarios focus not on the intrinsic value of nature, nor humanity's benefit from it, but peoples' *relational* experience of nature. This is harder to quantify, but includes culturally important species, ecosystems and landscapes, and the feeling of humanity as "part of " nature.

But how will implementing economic and land use decision-making based on these perspectives affect biodiversity worldwide? The LIFE metric can illustrate how changing patterns in land use could bring species closer to, or further away from, extinction related to land-use change.

We use the land use change data from PLUM simulations alongside a "habitat base layer" from Lumbierres et al. 2022 to create maps of changing habitat extents between scenarios.

## 0. Toolkit

We use the GBIF API to download 2010-2020 observations of many vertebrate species. We use the red list API to extract species-habitat associations. For land use, we use the *terra* package to hand the HILDA+ dataset.

```{r setup}
library(rgbif)
library(rredlist)
library(terra)


#TEST
aves <- occ_download_prep(
  pred("taxonKey", 3119195),
  pred_gt("elevation", 5000),
  user = "cmaney",
  pwd = "RC)Y}GHr.i8$YE8",
  email = "calummaney@gmail.com")


myredlistkey <- 'fd3cbfc9044a98a1a44be6c867f633b05a984aab7f730ba304067120ca94f6f0'
```

## 1. Retrieve GBIF observation data

![](images/clipboard-470818951.jpeg)

Follow the above schema from the paper, we retrieve and filter GBIF observation data to train our models.

We are going to use all mammals, all birds.

```{r}
gbif_call <- occ_download(
  pred_or(
    pred("taxonKey", 212), #birds
    pred("taxonKey", 359), #mammals
    pred("taxonKey", 131), #amphibia
    pred("taxonKey", 358) #reptiles
  ),
  
  pred_gte("year", 2010), #year start
  pred_lte("year", 2019), #year end
  
  #Points need coordinates
  pred_not(pred_isnull("decimalLatitude")),
  pred_not(pred_isnull("decimalLongitude")),
  
  #Keep observations only
  pred("basisOfRecord", "HUMAN_OBSERVATION"),
  
  #Keep only low-uncertainty locations
  pred_lte("coordinateUncertaintyInMeters", 100),
  
  #Retrieve simplified data
  format = "SIMPLE_CSV",
  
  user = "cmaney",
  pwd = "RC)Y}GHr.i8$YE8",
  email = "calummaney@gmail.com")
```

Then we wait and pull the file once it has been generated by gbif.

```{r}
occ_download_wait(gbif_call)

zip_file_path <- occ_download_get("0025277-251025141854904", path = ".", overwrite = TRUE)

gbif_data <- occ_download_import(zip_file_path)
```

## 2. Pull GBIF species data from the IUCN Red List

First, we need all the scientific names from the GBIF records database. We will get the column directly, get unique values only, then pass them through the GBIF backbone name resolver.

```{r}
gbif_sciNames <- unique(gbif_data$verbatimScientificName)

rredlist::rl_species(species = gbif_sciNames[1])
```

For \~7,000 unique species from birds, mammals, amphibians, or reptiles between 2010 and 2020.

## 3. Filter and clean, then join the datasets.

```{r}

```

## 4. Load land use data for the models

```{r}
hilda_years <- paste(seq(2010,2019))

hilda_url <- "https://download.pangaea.de/dataset/921846/files/hildap_vGLOB-1.0_geotiff.zip"

hilda_zip <- download.file(hilda_url, destfile = "raw_data/hilda_plus.zip", method="curl")

unzip(zipfile = "raw_data/hilda_plus.zip",exdir = "raw_data/hilda/")

hilda_files <- lapply(hilda_years,function(x){list.files(path = "raw_data/hilda/hildap_vGLOB-1.0_geotiff_wgs84/hildap_GLOB-v1.0_lulc-states/",pattern = x,full.names = TRUE)}) |> unlist()

hilda <- rast(hilda_files)
names(hilda) <- paste0("X",hilda_years)

hilda <- hilda |> as.factor()

# HILDA+ levels:
# 00 ocean
# 11 urban
# 22 cropland
# 33 pasture/rangeland
# 44 forest
# 55 unmanaged grass/shrubland
# 66 sparse/no vegetation
# 77 water
# 99 no data

hilda_levels <- data.frame(
    ID = c(00,11,22,33,44,55,66,77,99),
    plum_category = c("Ocean","Urban","Cropland","Pasture/Rangeland","Forest", "Unmanaged grass/shrubland","Sparse/no vegetation","Water","No data")
  )
levels(hilda) <- hilda_levels

#Finished, prepared data:
hilda
```

## 5. Fit logistic regressions to make a crosswalk table IUCN:PLUM

```{r}

```

## 6. Calculate habitat maps for each keystone PLUM year in scenarios

```{r}

```

## 4. Run LIFE methodology on the habitat maps

```{r}

```
